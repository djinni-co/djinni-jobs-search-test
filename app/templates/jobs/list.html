{% extends "base.html" %}

{% block content %}

<style>
  .text-clamp {
    display: -webkit-box;
    -webkit-line-clamp: 10;
    -webkit-box-orient: vertical;
    line-height: 1.3rem;
    height: calc(1.3rem * 10);
    overflow: hidden;
  }

  .text-clamp * {
    margin-bottom: 0;
  }

  .category-checkboxes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
  }

  .checkbox-wrapper {
      display: inline-block;
      margin-right: 10px;
  }

  .checkbox-wrapper input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      cursor: pointer;
  }

  .checkbox-wrapper label {
      padding: 5px 10px;
      border: 1px solid #007bff;
      border-radius: 4px;
      background-color: #f8f9fa;
      color: #007bff;
      cursor: pointer;
      display: inline-block;
      transition: background-color 0.3s ease, color 0.3s ease;
      font-size: 14px;
      white-space: nowrap;
  }

  .checkbox-wrapper input[type="checkbox"]:checked + label {
      background-color: #007bff;
      color: #fff;
  }

  .checkbox-wrapper label:hover {
      background-color: #e2e6ea;
  }
</style>

<!--Select only one checkbox-->
<script>
  function onlyOne(checkbox) {
    var checkboxes = document.getElementsByName(checkbox.name)
    checkboxes.forEach((item) => {
        if (item !== checkbox) item.checked = false
    })
}
</script>

<div class="container">
  <header class="pt-4 pb-4">
    <h1>Jobs on Djinni</h1>
  </header>

<div class="row">
    <div class="col-md-4">
      <form method="GET">
        <div class="form-group mb-3">
          {{ form.q.label_tag }}
          {{ form.q }}
        </div>

        <div class="form-group mb-3">
          <label>Search Type</label><br>
          <div class="form-check mb-2">
            {{ form.search_position }}
            {{ form.search_position.label_tag }}
          </div>
          <div class="form-check mb-2">
            {{ form.search_long_description }}
            {{ form.search_long_description.label_tag }}
          </div>
        </div>

        <div class="form-group mb-3">
          {{ form.any_keywords.label_tag }}
          {{ form.any_keywords }}
        </div>

        <div class="form-group mb-3">
          {{ form.exclude_keywords.label_tag }}
          {{ form.exclude_keywords }}
        </div>
        <button type="submit" class="btn btn-primary">Search</button>

        <div class="form-group mb-4">
          <label>Category</label>
          <div class="category-buttons mb-3">
          {% for value, label in category_filter_form.category_choices %}
            <div class="checkbox-wrapper mb-1">
                <input type="checkbox" id="category_{{ value }}" name="selected_category" value="{{ value }}"
                       {% if value == selected_category %}checked{% endif %}
                onclick="onlyOne(this)">
                <label for="category_{{ value }}">{{ label }}</label>
            </div>
          {% endfor %}
          </div>
        </div>
        <div class="form-group mb-4">
          <label>Remote type</label>
          <div class="category-buttons mb-3">
          {% for value, label in category_filter_form.remote_type_choices %}
            <div class="checkbox-wrapper mb-1">
                <input type="checkbox" id="remote_type_{{ value }}" name="selected_remote_type" value="{{ value }}"
                       {% if value == selected_remote_type %}checked{% endif %}
                onclick="onlyOne(this)">
                <label for="remote_type_{{ value }}">{{ label }}</label>
            </div>
          {% endfor %}
          </div>
        </div>
        <div class="form-group mb-4">
          <label>English level</label>
          <div class="category-buttons mb-3">
          {% for value, label in category_filter_form.english_level_choices %}
            <div class="checkbox-wrapper mb-1">
                <input type="checkbox" id="english_level_{{ value }}" name="selected_english_level" value="{{ value }}"
                       {% if value == selected_english_level %}checked{% endif %}
                onclick="onlyOne(this)">
                <label for="english_level_{{ value }}">{{ label }}</label>
            </div>
          {% endfor %}
          </div>
        </div>
        <div class="form-group mb-4">
          <label>Experience level</label>
          <div class="category-buttons mb-3">
          {% for value, label in category_filter_form.experience_level_choices %}
            <div class="checkbox-wrapper mb-1">
                <input type="checkbox" id="experience_level_{{ value }}" name="selected_experience_level" value="{{ value }}"
                       {% if value == selected_experience_level %}checked{% endif %}
                onclick="onlyOne(this)">
                <label for="experience_level_{{ value }}">{{ label }}</label>
            </div>
          {% endfor %}
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
      </form>
    </div>

    <div class="col-md-8">
      <header class="pt-4 pb-4">
        <h1>
            {{ selected_category }} {{ selected_remote_type }} {{ selected_english_level }} {{ selected_experience_level }}
        </h1>
      </header>
      <div id="jobs_list">
        {% for job in jobs %}
          <div id="job_{{ job.id }}" class="mb-5">
            <h2 class="h4 text-primary">
              {{ job.position }}
              {% if job.public_salary_max %}
                <span class="text-success">to ${{ job.public_salary_max }}</span>
              {% endif %}
              <small class="text-secondary">at {{ job.company.name }}</small>
            </h2>
            <div>
              <div class="text-clamp">
                <h6 class="text-primary">
                  <b class="text-secondary">primary keyword: {{ job.primary_keyword }}; </b>
                  <b class="text-secondary">remote type: {{ job.remote_type }}; </b>
                  <b class="text-secondary">experience_level: {{ job.experience_years }}; </b>
                </h6>
                {{ job.long_description|safe }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if is_paginated %}
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            {% if jobs.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ jobs.previous_page_number }}&{{ querystring }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <a class="page-link" href="#" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
            {% endif %}

            {% for num in jobs.paginator.page_range %}
              {% if jobs.number == num %}
                <li class="page-item active">
                  <a class="page-link" href="#">{{ num }}</a>
                </li>
              {% elif num > jobs.number|add:'-5' and num < jobs.number|add:'5' %}
                <li class="page-item">
                  <a class="page-link" href="?page={{ num }}&{{ querystring }}">{{ num }}</a>
                </li>
              {% endif %}
            {% endfor %}

            {% if jobs.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ jobs.next_page_number }}&{{ querystring }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <a class="page-link" href="#" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endif %}
    </div>
  </div>
</div>

{% endblock content %}
